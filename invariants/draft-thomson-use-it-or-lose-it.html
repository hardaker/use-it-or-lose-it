<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Long-term Viability of Protocol Extension Mechanisms</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract p {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre, span.tt {
  font: 13.5px Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>
  <meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Implementations of Protocols are Imperfect">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Good Protocol Design is Not Sufficient">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Multi-Party Interactions and Middleboxes">
<link href="#rfc.section.3" rel="Chapter" title="3 Retaining Viable Protocol Evolution Mechanisms">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Examples of Active Use">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Dependency is Better">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Unused Extension Points Become Unusable">
<link href="#rfc.section.4" rel="Chapter" title="4 Defensive Design Principles for Protocols">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Active Use">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Grease">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Invariants">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Cryptography">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Effective Feedback">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="7 Informative References">
<link href="#rfc.acknowledgments" rel="Chapter">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.22.2 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Thomson, M." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-thomson-use-it-or-lose-it-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-03-30" />
  <meta name="dct.abstract" content="The ability to change protocols depends on exercising the extension and version negotiation mechanisms that support change.  Protocols that don&#8217;t use these mechanisms can find that deploying changes can be difficult and costly." />
  <meta name="description" content="The ability to change protocols depends on exercising the extension and version negotiation mechanisms that support change.  Protocols that don&#8217;t use these mechanisms can find that deploying changes can be difficult and costly." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Thomson</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Mozilla</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">March 30, 2019</td>
</tr>
<tr>
<td class="left">Expires: October 1, 2019</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Long-term Viability of Protocol Extension Mechanisms<br />
  <span class="filename">draft-thomson-use-it-or-lose-it-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The ability to change protocols depends on exercising the extension and version negotiation mechanisms that support change.  Protocols that don&#8217;t use these mechanisms can find that deploying changes can be difficult and costly.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 1, 2019.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Implementations of Protocols are Imperfect</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Good Protocol Design is Not Sufficient</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Multi-Party Interactions and Middleboxes</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Retaining Viable Protocol Evolution Mechanisms</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Examples of Active Use</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Dependency is Better</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Unused Extension Points Become Unusable</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Defensive Design Principles for Protocols</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Active Use</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Grease</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Invariants</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Cryptography</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Effective Feedback</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.references">Informative References</a>
</li>
<li><a href="#rfc.acknowledgments">Acknowledgments</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">A successful protocol <a href="#SUCCESS" class="xref">[SUCCESS]</a> will change in ways that allow it to continue to fulfill the needs of its users.  New use cases, conditions and constraints on the deployment of a protocol can render a protocol that does not change obsolete.</p>
<p id="rfc.section.1.p.2">Usage patterns and requirements for a protocol shift over time.  Protocols can react to these shifts in one of three ways: adjust usage patterns within the constraints of the protocol, extend the protocol, and replace the protocol.  These reactions are progressively more disruptive, but are also dictated by the nature of the change in requirements over longer periods.</p>
<p id="rfc.section.1.p.3">Experience with Internet-scale protocol deployment shows that changing protocols is not uniformly successful.  <a href="#TRANSITIONS" class="xref">[TRANSITIONS]</a> examines the problem more broadly.</p>
<p id="rfc.section.1.p.4">This document examines the specific conditions that determine whether protocol maintainers have the ability to design and deploy new or modified protocols.  <a href="#strategies" class="xref">Section 4</a> outlines several strategies that might aid in ensuring that protocol changes remain possible over time.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#implementations-of-protocols-are-imperfect" id="implementations-of-protocols-are-imperfect">Implementations of Protocols are Imperfect</a>
</h1>
<p id="rfc.section.2.p.1">A change to a protocol can be made extremely difficult to deploy if there are bugs in implementations with which the new deployment needs to interoperate.  Bugs in the handling of new codepoints or extensions can mean that instead of handling the mechanism as designed, endpoints react poorly.  This can manifest as abrupt termination of sessions, errors, crashes, or disappearances of endpoints and timeouts.</p>
<p id="rfc.section.2.p.2">Interoperability with other implementations is usually highly valued, so deploying mechanisms that trigger adverse reactions can be untenable.  Where interoperability is a competitive advantage, this is true even if the negative reactions happen infrequently or only under relatively rare conditions.</p>
<p id="rfc.section.2.p.3">Deploying a change to a protocol could require fixing a substantial proportion of the bugs that the change exposes.  This can involve a difficult process that includes identifying the cause of these errors, finding the responsible implementation, coordinating a bug fix and release plan, contacting the operator of affected services, and waiting for the fix to be deployed to those services.</p>
<p id="rfc.section.2.p.4">Given the effort involved in fixing problems, the existence of these sorts of bugs can outright prevent the deployment of some types of protocol changes.  It could even be necessary to come up with a new protocol design that uses a different method to achieve the same result.</p>
<p id="rfc.section.2.p.5">The set of interoperable features in a protocol is often the subset of its features that have some value to those implementing and deploying the protocol.  It is not always the case that future extensibility is in that set.</p>
<h2 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#good-protocol-design-is-not-sufficient" id="good-protocol-design-is-not-sufficient">Good Protocol Design is Not Sufficient</a>
</h2>
<p id="rfc.section.2.1.p.1">It is often argued that the design of a protocol extension point or version negotiation capability is critical to the freedom that it ultimately offers.</p>
<p id="rfc.section.2.1.p.2">RFC 6709 <a href="#EXTENSIBILITY" class="xref">[EXTENSIBILITY]</a> contains a great deal of well-considered advice on designing for extension.  It includes the following advice:</p>
<p></p>

<ul class="empty"><li>This means that, to be useful, a protocol version- negotiation mechanism should be simple enough that it can reasonably be assumed that all the implementers of the first protocol version at least managed to implement the version-negotiation mechanism correctly.</li></ul>
<p id="rfc.section.2.1.p.4">This has proven to be insufficient in practice.  Many protocols have evidence of imperfect implementation of critical mechanisms of this sort.  Mechanisms that aren&#8217;t used are the ones that fail most often.  The same paragraph from RFC 6709 acknowledges the existence of this problem, but does not offer any remedy:</p>
<p></p>

<ul class="empty"><li>The nature of protocol version-negotiation mechanisms is that, by definition, they don&#8217;t get widespread real-world testing until <em>after</em> the base protocol has been deployed for a while, and its deficiencies have become evident.</li></ul>
<p id="rfc.section.2.1.p.6">Indeed, basic interoperability is considered critical early in the deployment of a protocol, and any engineering practice that values simplicity will tend to make version negotiation and extension mechanisms optional for this basic interoperability. This leads to these mechanisms being uniquely affected by this problem.</p>
<p id="rfc.section.2.1.p.7">Transport Layer Security (TLS) <a href="#TLS12" class="xref">[TLS12]</a> provides examples of where a design that is objectively sound fails when incorrectly implemented.  TLS provides examples of failures in protocol version negotiation and extensibility.</p>
<p id="rfc.section.2.1.p.8">Version negotiation in TLS 1.2 and earlier uses the &#8220;Highest mutually supported version (HMSV)&#8221; scheme exactly as it is described in <a href="#EXTENSIBILITY" class="xref">[EXTENSIBILITY]</a>.  However, clients are unable to advertise a new version without causing a non-trivial proportions of sessions to fail due to bugs in server and middlebox implementations.</p>
<p id="rfc.section.2.1.p.9">Intolerance to new TLS versions is so severe <a href="#INTOLERANCE" class="xref">[INTOLERANCE]</a> that TLS 1.3 <a href="#TLS13" class="xref">[TLS13]</a> has abandoned HMSV version negotiation for a new mechanism.</p>
<p id="rfc.section.2.1.p.10">The server name indication (SNI) <a href="#TLS-EXT" class="xref">[TLS-EXT]</a> in TLS is another excellent example of the failure of a well-designed extensibility point.  SNI uses the same technique for extension that is used with considerable success in other parts of the TLS protocol.  The original design of SNI includes the ability to include multiple names of different types.</p>
<p id="rfc.section.2.1.p.11">What is telling in this case is that SNI was defined with just one type of name: a domain name.  No other type has ever been standardized, though several have been proposed.  Despite an otherwise exemplary design, SNI is so inconsistently implemented that any hope for using the extension point it defines has been abandoned <a href="#SNI" class="xref">[SNI]</a>.</p>
<h2 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#multi-party-interactions-and-middleboxes" id="multi-party-interactions-and-middleboxes">Multi-Party Interactions and Middleboxes</a>
</h2>
<p id="rfc.section.2.2.p.1">Even the most superficially simple protocols can often involve more actors than is immediately apparent.  A two-party protocol has two ends, but even at the endpoints of an interaction, protocol elements can be passed on to other entities in ways that can affect protocol operation.</p>
<p id="rfc.section.2.2.p.2">One of the key challenges in deploying new features is ensuring compatibility with all actors that could be involved in the protocol.</p>
<p id="rfc.section.2.2.p.3">Protocols deployed without active measures against intermediation will tend to become intermediated over time, as network operators deploy middleboxes to perform some function on traffic <a href="#PATH-SIGNALS" class="xref">[PATH-SIGNALS]</a>.  In particular, one of the consequences of an unencrypted protocol is that any element on path can interact with the protocol.  For example, HTTP was specifically designed with intermediation in mind, transparent proxies <a href="#HTTP" class="xref">[HTTP]</a> are not only possible but sometimes advantageous, despite some significant downsides.  Consequently, transparent proxies for cleartext HTTP are commonplace.</p>
<p id="rfc.section.2.2.p.4">Middleboxes are also protocol participants, to the degree that they are able to observe and act in ways that affect the protocol.  The degree to which a middlebox participates varies from the basic functions that a router performs to full participation.  For example, a SIP back-to-back user agent (B2BUA) <a href="#B2BUA" class="xref">[B2BUA]</a> can be very deeply involved in the SIP protocol.</p>
<p id="rfc.section.2.2.p.5">This phenomenon appears at all layers of the protocol stack, even when protocols are not designed with middlebox participation in mind. TCP&#8217;s <a href="#TCP" class="xref">[TCP]</a> extension points have been rendered difficult to use, largely due to middlebox interactions, as experience with Multipath TCP <a href="#MPTCP" class="xref">[MPTCP]</a> and Fast Open <a href="#TFO" class="xref">[TFO]</a> has shown. IP&#8217;s version field was rendered useless when encapsulated over Ethernet, requring a new ethertype with IPv6 <a href="#RFC2462" class="xref">[RFC2462]</a>, due in part to layer 2 devices making version-independent assumptions about the structure of the IPv4 header.</p>
<p id="rfc.section.2.2.p.6">By increasing the number of different actors involved in any single protocol exchange, the number of potential implementation bugs that a deployment needs to contend with also increases.  In particular, incompatible changes to a protocol that might be negotiated between endpoints in ignorance of the presence of a middlebox can result in a middlebox acting badly.</p>
<p id="rfc.section.2.2.p.7">Thus, middleboxes can increase the difficulty of deploying changes to a protocol considerably.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#use-it" id="use-it">Retaining Viable Protocol Evolution Mechanisms</a>
</h1>
<p id="rfc.section.3.p.1">The design of a protocol for extensibility and eventual replacement <a href="#EXTENSIBILITY" class="xref">[EXTENSIBILITY]</a> does not guarantee the ability to exercise those options.  The set of features that enable future evolution need to be interoperable in the first implementations and deployments of the protocol.  Active use of mechanisms that support evolution is the only way to ensure that they remain available for new uses.</p>
<h2 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#examples-of-active-use" id="examples-of-active-use">Examples of Active Use</a>
</h2>
<p id="rfc.section.3.1.p.1">The conditions for retaining the ability to evolve a design is most clearly evident in the protocols that are known to have viable version negotiation or extension points.  The definition of mechanisms alone is insufficient; it&#8217;s the active use of those mechanisms that determines the existence of freedom.</p>
<p id="rfc.section.3.1.p.2">For example, header fields in email <a href="#SMTP" class="xref">[SMTP]</a>, HTTP <a href="#HTTP" class="xref">[HTTP]</a> and SIP <a href="#SIP" class="xref">[SIP]</a> all derive from the same basic design.  There is no evidence of significant barriers to deploying header fields with new names and semantics in email and HTTP, though the widespread deployment of SIP B2BUAs means that new SIP header fields do not reliably reach peers.</p>
<p id="rfc.section.3.1.p.3">In another example, the attribute-value pairs (AVPs) in Diameter <a href="#DIAMETER" class="xref">[DIAMETER]</a> are fundamental to the design of the protocol.  The definition of new uses of Diameter regularly exercise the ability to add new AVPs and do so with no fear that the new feature might not be successfully deployed.</p>
<p id="rfc.section.3.1.p.4">These examples show extension points that are heavily used also being relatively unaffected by deployment issues preventing addition of new values for new use cases.</p>
<p id="rfc.section.3.1.p.5">These examples also confirm the case that good design is not a prerequisite for success.  On the contrary, success is often despite shortcomings in the design.  For instance, the shortcomings of HTTP header fields are significant enough that there are ongoing efforts to improve the syntax <a href="#HTTP-HEADERS" class="xref">[HTTP-HEADERS]</a>.</p>
<p id="rfc.section.3.1.p.6">Only using a protocol capability is able to ensure availability of that capability.  Protocols that fail to use a mechanism, or a protocol that only rarely uses a mechanism, suffer an inability to rely on that mechanism.</p>
<h2 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#need-it" id="need-it">Dependency is Better</a>
</h2>
<p id="rfc.section.3.2.p.1">The best way to guarantee that a protocol mechanism is used is to make it critical to an endpoint participating in that protocol.  This means that implementations rely on both the existence of the protocol mechanism and its use.</p>
<p id="rfc.section.3.2.p.2">For example, the message format in SMTP relies on header fields for most of its functions, including the most basic functions.  A deployment of SMTP cannot avoid including an implementation of header field handling.  In addition to this, the regularity with which new header fields are defined and used ensures that deployments frequently encounter header fields that it does not understand.  An SMTP implementation therefore needs to be able to both process header fields that it understands and ignore those that it does not.</p>
<p id="rfc.section.3.2.p.3">In this way, implementing the extensibility mechanism is not merely mandated by the specification, it is crucial to the functioning of a protocol deployment.  Should an implementation fail to correctly implement the mechanism, that failure would quickly become apparent.</p>
<p id="rfc.section.3.2.p.4">Caution is advised to avoid assuming that building a dependency on an extension mechanism is sufficient to ensure availability of that mechanism in the long term.  If the set of possible uses is narrowly constrained and deployments do not change over time, implementations might not see new variations or assume a narrower interpretation of what is possible.  Those implementations might still exhibit errors when presented with a new variation.</p>
<h2 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#unused" id="unused">Unused Extension Points Become Unusable</a>
</h2>
<p id="rfc.section.3.3.p.1">In contrast, there are many examples of extension points in protocols that have been either completely unused, or their use was so infrequent that they could no longer be relied upon to function correctly.</p>
<p id="rfc.section.3.3.p.2">HTTP has a number of very effective extension points in addition to the aforementioned header fields.  It also has some examples of extension point that are so rarely used that it is possible that they are not at all usable.  Extension points in HTTP that might be unwise to use include the extension point on each chunk in the chunked transfer coding <a href="#HTTP" class="xref">[HTTP]</a>, the ability to use transfer codings other than the chunked coding, and the range unit in a range request <a href="#HTTP-RANGE" class="xref">[HTTP-RANGE]</a>.</p>
<p id="rfc.section.3.3.p.3">Even where extension points have multiple valid values, if the set of permitted values does not change over time, there is still a risk that new values are not tolerated by existing implementations.  If the set of values for a particular field remains fixed over a long period, some implementations might not correctly handle a new value when it is introduced.  For example, implementations of TLS broke when new values of the signature_algorithms extension were introduced.</p>
<p id="rfc.section.3.3.p.4">Codepoints that are reserved for future use can be especially problematic.  Reserving codepoints without attributing semantics to their use can result in diverse or conflicting semantics being attributed without any hope of interoperability.  An example of this is the &#8220;class E&#8221; address space in IPv4 <a href="#RFC0988" class="xref">[RFC0988]</a>, which was reserved without assigning any semantics.  For protocols that can use negotiation to attribute semantics to codepoints, it is possible that unused codepoints can be reclaimed for active use, though this requires that the negotiation include all protocol participants.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#strategies" id="strategies">Defensive Design Principles for Protocols</a>
</h1>
<p id="rfc.section.4.p.1">There are several potential approaches that can provide some measure of protection against a protocol deployment becoming resistant to change.</p>
<h2 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#active-use" id="active-use">Active Use</a>
</h2>
<p id="rfc.section.4.1.p.1">As discussed in <a href="#use-it" class="xref">Section 3</a>, the most effective defense against misuse of protocol extension points is active use.</p>
<p id="rfc.section.4.1.p.2">Implementations are most likely to be tolerant of new values if they depend on being able to use new values.  Failing that, implementations that routinely see new values are more likely to correctly handle new values.  More frequent changes will improve the likelihood that incorrect handling or intolerance is discovered and rectified.  The longer an intolerant implementation is deployed, the more difficult it is to correct.</p>
<p id="rfc.section.4.1.p.3">What active use means could depend greatly on the environment in which a protocol is deployed.  The frequency of changes necessary to safeguard some mechanisms might be slow enough to attract ossification in another protocol deployment, while being excessive in others.  There are currently no firm guidelines for new protocol development, as much is being learned about what techniques are most effective.</p>
<h2 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#grease" id="grease">Grease</a>
</h2>
<p id="rfc.section.4.2.p.1">&#8220;Grease&#8221; <a href="#GREASE" class="xref">[GREASE]</a> identifies lack of use as an issue (protocol mechanisms &#8220;rusting&#8221; shut) and proposes a system of use that exercises extension points by using dummy values.  Greasing is any attempt to exercise extension points without changing endpoint behavior, other than to encourage participants to tolerate new or varying values of protocol elements.</p>
<p id="rfc.section.4.2.p.2">The grease design is aimed at the style of negotiation most used in TLS, where the client offers a set of options and the server chooses the one that it most prefers from those that it supports.  A client that uses grease randomly offers options - usually just one - from a set of reserved values.  These values are guaranteed to never be assigned real meaning, so the server will never have cause to genuinely select one of these values.</p>
<p id="rfc.section.4.2.p.3">The principle that grease operates on is that an implementation that is regularly exposed to unknown values is not likely to become intolerant of new values when they appear.  This depends largely on the assumption that the difficulty of implementing the protocol mechanism correctly is not significantly more effort than implementing code to specifically filter out the randomized grease values.  Reserving random or unevenly distributed values for this purpose is thought to further discourage special treatment.</p>
<p id="rfc.section.4.2.p.4">Without reserved greasing codepoints, an implementation can use code points from spaces used for private or experimental use if such a range exists.  In addition to the risk of triggering participation in an unwanted experiment, this can be less effective.  Incorrect implementations might still be able to correctly identify these code points and ignore them.</p>
<p id="rfc.section.4.2.p.5">Grease is deployed with the intent of quickly detecting errors in implementing the mechanisms it safeguards.  Though it has been effective at revealing problems in some cases with TLS, its efficacy isn&#8217;t proven more generally.</p>
<p id="rfc.section.4.2.p.6">This style of defensive design is limited because it is only superficial.  It only exercises a small part of the mechanisms supporting extensibility.  More critically, it does not easily translate to all forms of extension point.  For instance, HMSV negotiation cannot be greased in this fashion.  Other techniques might be necessary for protocols that don&#8217;t rely on the particular style of exchange that is predominant in TLS.</p>
<h2 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#invariants" id="invariants">Invariants</a>
</h2>
<p id="rfc.section.4.3.p.1">Documenting aspects of the protocol that cannot or will not change as extensions or new versions are added can be a useful exercise. Understanding what aspects of a protocol are invariant can help guide the process of protecting those parts of the protocol that might change.</p>
<p id="rfc.section.4.3.p.2">Like greasing, a declaration of protocol invariants is useful only to the extent that implementations of the protocol are willing to admit the possibility of new uses for the protocol.  A protocol that declares protocol invariants relies on implementations understanding and respecting those invariants.</p>
<p id="rfc.section.4.3.p.3">Protocol invariants need to be clearly and concisely documented.  Including examples of aspects of the protocol that are not invariant, such as the appendix of <a href="#QUIC-INVARIANTS" class="xref">[QUIC-INVARIANTS]</a>, can be used to clarify intent.</p>
<h2 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#cryptography" id="cryptography">Cryptography</a>
</h2>
<p id="rfc.section.4.4.p.1">Cryptography can be used to reduce the number of entities that can participate in a protocol.  Using tools like TLS ensures that only authorized participants are able to influence whether a new protocol feature is used.</p>
<p id="rfc.section.4.4.p.2">Permitting fewer protocol participants reduces the number of implementations that can prevent a new mechanism from being deployed.  As recommended in <a href="#PATH-SIGNALS" class="xref">[PATH-SIGNALS]</a>, use of encryption and integrity protection can be used to limit participation.</p>
<p id="rfc.section.4.4.p.3">For example, the QUIC protocol <a href="#QUIC" class="xref">[QUIC]</a> adopts both encryption and integrity protection.  Encryption is used to carefully control what information is exposed to middleboxes.  For those fields that are not encrypted, QUIC uses integrity protection to prevent modification.</p>
<h2 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#effective-feedback" id="effective-feedback">Effective Feedback</a>
</h2>
<p id="rfc.section.4.5.p.1">While not a direct means of protecting extensibility mechanisms, feedback systems can be important to discovering problems.</p>
<p id="rfc.section.4.5.p.2">Visibility of errors is critical to the success of the grease technique (see <a href="#grease" class="xref">Section 4.2</a>).  The grease design is most effective if a deployment has a means of detecting and reporting errors.  Ignoring errors could allow problems to become entrenched.</p>
<p id="rfc.section.4.5.p.3">Feedback on errors is more important during the development and early deployment of a change.  It might also be helpful to disable automatic error recovery methods during development.</p>
<p id="rfc.section.4.5.p.4">Automated feedback systems are important for automated systems, or where error recovery is also automated.  For instance, connection failures with HTTP alternative services <a href="#ALT-SVC" class="xref">[ALT-SVC]</a> are not permitted to affect the outcome of transactions.  An automated feedback system for capturing failures in alternative services is therefore necessary for failures to be detected.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">The ability to design, implement, and deploy new protocol mechanisms can be critical to security.  In particular, it is important to be able to replace cryptographic algorithms over time <a href="#AGILITY" class="xref">[AGILITY]</a>.  For example, preparing for replacement of weak hash algorithms was made more difficult through misuse <a href="#HASH" class="xref">[HASH]</a>.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This document makes no request of IANA.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="AGILITY">[AGILITY]</b></td>
<td class="top">
<a>Housley, R.</a>, "<a href="https://tools.ietf.org/html/rfc7696">Guidelines for Cryptographic Algorithm Agility and Selecting Mandatory-to-Implement Algorithms</a>", BCP 201, RFC 7696, DOI 10.17487/RFC7696, November 2015.</td>
</tr>
<tr>
<td class="reference"><b id="ALT-SVC">[ALT-SVC]</b></td>
<td class="top">
<a>Nottingham, M.</a>, <a>McManus, P.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7838">HTTP Alternative Services</a>", RFC 7838, DOI 10.17487/RFC7838, April 2016.</td>
</tr>
<tr>
<td class="reference"><b id="B2BUA">[B2BUA]</b></td>
<td class="top">
<a>Kaplan, H.</a> and <a>V. Pascual</a>, "<a href="https://tools.ietf.org/html/rfc7092">A Taxonomy of Session Initiation Protocol (SIP) Back-to-Back User Agents</a>", RFC 7092, DOI 10.17487/RFC7092, December 2013.</td>
</tr>
<tr>
<td class="reference"><b id="DIAMETER">[DIAMETER]</b></td>
<td class="top">
<a>Fajardo, V.</a>, <a>Arkko, J.</a>, <a>Loughney, J.</a> and <a>G. Zorn</a>, "<a href="https://tools.ietf.org/html/rfc6733">Diameter Base Protocol</a>", RFC 6733, DOI 10.17487/RFC6733, October 2012.</td>
</tr>
<tr>
<td class="reference"><b id="EXTENSIBILITY">[EXTENSIBILITY]</b></td>
<td class="top">
<a>Carpenter, B.</a>, <a>Aboba, B.</a> and <a>S. Cheshire</a>, "<a href="https://tools.ietf.org/html/rfc6709">Design Considerations for Protocol Extensions</a>", RFC 6709, DOI 10.17487/RFC6709, September 2012.</td>
</tr>
<tr>
<td class="reference"><b id="GREASE">[GREASE]</b></td>
<td class="top">
<a>Benjamin, D.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-tls-grease-02">Applying GREASE to TLS Extensibility</a>", Internet-Draft draft-ietf-tls-grease-02, January 2019.</td>
</tr>
<tr>
<td class="reference"><b id="HASH">[HASH]</b></td>
<td class="top">
<a>Bellovin, S.</a> and <a>E. Rescorla</a>, "<a href="https://www.cs.columbia.edu/~smb/papers/new-hash.pdf">Deploying a New Hash Algorithm</a>", Proceedings of NDSS '06 , 2006.</td>
</tr>
<tr>
<td class="reference"><b id="HTTP">[HTTP]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="HTTP-HEADERS">[HTTP-HEADERS]</b></td>
<td class="top">
<a>Nottingham, M.</a> and <a>P. Kamp</a>, "<a href="https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-09">Structured Headers for HTTP</a>", Internet-Draft draft-ietf-httpbis-header-structure-09, December 2018.</td>
</tr>
<tr>
<td class="reference"><b id="HTTP-RANGE">[HTTP-RANGE]</b></td>
<td class="top">
<a>Fielding, R.</a>, <a>Lafon, Y.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7233">Hypertext Transfer Protocol (HTTP/1.1): Range Requests</a>", RFC 7233, DOI 10.17487/RFC7233, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="INTOLERANCE">[INTOLERANCE]</b></td>
<td class="top">
<a>Kario, H.</a>, "<a href="https://mailarchive.ietf.org/arch/msg/tls/bOJ2JQc3HjAHFFWCiNTIb0JuMZc">Re: [TLS] Thoughts on Version Intolerance</a>", July 2016.</td>
</tr>
<tr>
<td class="reference"><b id="MPTCP">[MPTCP]</b></td>
<td class="top">
<a>Ford, A.</a>, <a>Raiciu, C.</a>, <a>Handley, M.</a> and <a>O. Bonaventure</a>, "<a href="https://tools.ietf.org/html/rfc6824">TCP Extensions for Multipath Operation with Multiple Addresses</a>", RFC 6824, DOI 10.17487/RFC6824, January 2013.</td>
</tr>
<tr>
<td class="reference"><b id="PATH-SIGNALS">[PATH-SIGNALS]</b></td>
<td class="top">
<a>Hardie, T.</a>, "<a href="https://tools.ietf.org/html/draft-iab-path-signals-03">Transport Protocol Path Signals</a>", Internet-Draft draft-iab-path-signals-03, January 2019.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC">[QUIC]</b></td>
<td class="top">
<a>Iyengar, J.</a> and <a>M. Thomson</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-transport-19">QUIC: A UDP-Based Multiplexed and Secure Transport</a>", Internet-Draft draft-ietf-quic-transport-19, March 2019.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-INVARIANTS">[QUIC-INVARIANTS]</b></td>
<td class="top">
<a>Thomson, M.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-invariants-03">Version-Independent Properties of QUIC</a>", Internet-Draft draft-ietf-quic-invariants-03, October 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC0988">[RFC0988]</b></td>
<td class="top">
<a>Deering, S.</a>, "<a href="https://tools.ietf.org/html/rfc988">Host extensions for IP multicasting</a>", RFC 988, DOI 10.17487/RFC0988, July 1986.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2462">[RFC2462]</b></td>
<td class="top">
<a>Thomson, S.</a> and <a>T. Narten</a>, "<a href="https://tools.ietf.org/html/rfc2462">IPv6 Stateless Address Autoconfiguration</a>", RFC 2462, DOI 10.17487/RFC2462, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="SIP">[SIP]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="https://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, DOI 10.17487/RFC3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="SMTP">[SMTP]</b></td>
<td class="top">
<a>Resnick, P.</a>, "<a href="https://tools.ietf.org/html/rfc5322">Internet Message Format</a>", RFC 5322, DOI 10.17487/RFC5322, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="SNI">[SNI]</b></td>
<td class="top">
<a>Langley, A.</a>, "<a href="https://mailarchive.ietf.org/arch/msg/tls/1t79gzNItZd71DwwoaqcQQ_4Yxc">Accepting that other SNI name types will never work</a>", March 2016.</td>
</tr>
<tr>
<td class="reference"><b id="SUCCESS">[SUCCESS]</b></td>
<td class="top">
<a>Thaler, D.</a> and <a>B. Aboba</a>, "<a href="https://tools.ietf.org/html/rfc5218">What Makes for a Successful Protocol?</a>", RFC 5218, DOI 10.17487/RFC5218, July 2008.</td>
</tr>
<tr>
<td class="reference"><b id="TCP">[TCP]</b></td>
<td class="top">
<a>Postel, J.</a>, "<a href="https://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>", STD 7, RFC 793, DOI 10.17487/RFC0793, September 1981.</td>
</tr>
<tr>
<td class="reference"><b id="TFO">[TFO]</b></td>
<td class="top">
<a>Cheng, Y.</a>, <a>Chu, J.</a>, <a>Radhakrishnan, S.</a> and <a>A. Jain</a>, "<a href="https://tools.ietf.org/html/rfc7413">TCP Fast Open</a>", RFC 7413, DOI 10.17487/RFC7413, December 2014.</td>
</tr>
<tr>
<td class="reference"><b id="TLS-EXT">[TLS-EXT]</b></td>
<td class="top">
<a>Eastlake 3rd, D.</a>, "<a href="https://tools.ietf.org/html/rfc6066">Transport Layer Security (TLS) Extensions: Extension Definitions</a>", RFC 6066, DOI 10.17487/RFC6066, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="TLS12">[TLS12]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="TLS13">[TLS13]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="https://tools.ietf.org/html/rfc8446">The Transport Layer Security (TLS) Protocol Version 1.3</a>", RFC 8446, DOI 10.17487/RFC8446, August 2018.</td>
</tr>
<tr>
<td class="reference"><b id="TRANSITIONS">[TRANSITIONS]</b></td>
<td class="top">
<a>Thaler, D.</a>, "<a href="https://tools.ietf.org/html/rfc8170">Planning for Protocol Adoption and Subsequent Transitions</a>", RFC 8170, DOI 10.17487/RFC8170, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.acknowledgments"><a href="#rfc.acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.A.p.1">Mirja K&#252;hlewind, Mark Nottingham, and Brian Trammell made significant contributions to this document.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Thomson</span> 
	  <span class="n hidden">
		<span class="family-name">Thomson</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mt@lowentropy.net">mt@lowentropy.net</a></span>

  </address>
</div>

</body>
</html>
